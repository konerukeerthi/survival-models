---
title: "survival lecture 5"
author: "Steve Simon"
date: "April 8, 2018"
output: html_document
---

Lecture 5. Extensions of the Cox model (interval censoring, stratified models). In this lecture, you will examine two important extensions of the Cox model, interval censoring and stratified models. You’ll see how interval censoring provides a more general framework for survival models and see important applications that rely on interval censoring. You’ll also fit stratified models to account for different hazard functions within strata.

This file does not need any special libraries other than the ones listed below. Many of the data sets in this program use data from Hosmer, Lemeshow, and May. I made one minor change, however, which was to force all the variable names to lower case.

```{r load-libraries}
library(broom)
library(dplyr)
library(ggplot2)
library(magrittr)
library(survival)
library(tidyr)
```

## Stratified models

Page 211 of Hosmer, Lemeshow, and May shows how to fit a stratified model by quartile of CD4 cell count using the ACTG320 data set.

```{r read-actg320}
fn <- "~/survival-models/data/wiley/actg320.dat" 
actg320 <- read.table(fn, header = FALSE) 
names(actg320) <- c(
  "id",
  "time", 
  "censor",
  "time_d",
  "censor_d",
  "tx",
  "txgrp",
  "strat2",
  "sex",
  "raceth",
  "ivdrug",
  "hemophil",
  "karnof",
  "cd4",
  "priorzdv",
  "age")
head(actg320)
```

## Interval censoring

Page 235 of Hosmer, Lemeshow, and May shows interval censoring using the GBCS data set.

```{r read-gbcs}
fn <- "~/survival-models/data/wiley/gbcs.dat" 
gbcs <- read.table(fn, header = FALSE) 
names(gbcs) <- c(
  "id",
  "diagdate",
  "recdate",
  "deathdate",
  "age",
  "menopause",
  "hormone",
  "size",
  "grade",
  "nodes",
  "prog_recp",
  "estrg_recp",
  "rectime",
  "censrec",
  "survtime",
  "censdead")

head(gbcs)
```

## Additional topics

* Schoenfeld residual, scaled Schoenfeld residual

* Martingale/Cox and Snell residual: Ci-H(ti, X, beta)

* How to check proportional hazards assumption, plot Schoenfeld residual versus time.

* Influential data, Cook's d. This is described on page 185. Also see the whas500 data in Table 6.2, 5.13

Save everything for possible later re-use.

```{r save-everything}
save.image("~/survival-models/bin/survival-lecture-5.RData")
```