---
title: "homework answers 3"
author: "Steve Simon"
date: "May 14, 2018"
output: html_document
---

## 1. Recalculate the sample size in the lecture if the early dropout rate is 0.1 or 0.3 instead of 0.2.

The original sample size calculation was

$n_1 =$ 25 / ((1-0.2)(1-`r round(exp(-1.2), 2)`)) 
= `r round(25 / (0.8*(1-exp(-1.2))), 1)`.

$n_2 =$ 50 / ((1-0.2)(1-`r round(exp(-2.4), 2)`)) 
= `r round(50 / (0.8*(1-exp(-2.4))), 1)`.

If the dropout rate is 10% rather than 20%, your intuition ought to be that the overall sample size would be less. Let's see.

$n_1 =$ 25 / ((1-0.1)(1-`r round(exp(-1.2), 2)`)) 
= `r round(25 / (0.9*(1-exp(-1.2))), 1)`.

$n_2 =$ 50 / ((1-0.1)(1-`r round(exp(-2.4), 2)`)) 
= `r round(50 / (0.9*(1-exp(-2.4))), 1)`.

Well, bust my buttons! You were right. A dropout rate of 30% should increase the total sample size.

$n_1 =$ 25 / ((1-0.3)(1-`r round(exp(-1.2), 2)`)) 
= `r round(25 / (0.7*(1-exp(-1.2))), 1)`.

$n_2 =$ 50 / ((1-0.3)(1-`r round(exp(-2.4), 2)`)) 
= `r round(50 / (0.7*(1-exp(-2.4))), 1)`.

Right again! You're good at this.

## 2. Recalculate the sample size if the average time of follow up is 2 years or 4 years instead of 3 years.

Remember to switch the dropout rate back to 20% for this problem.

This takes a bit more work. The survival function for the exponential distribution is

$S(t)=e^{-\lambda t}$

If the follow-up time is 2 years rather than 3 years, the probability of observing a death will be less in either group, requiring a larger overall sample size.

For the two groups, $\lambda$ is either 0.4 or 0.8, So $e^{-\lambda t}$ would be

$e^{-0.8}=$ `r round(exp(-0.8), 2)` instead of $e^{-1.2}=$ `r round(exp(-1.2), 2)` in the first group and $e^{-1.6}=$ `r round(exp(-1.6), 2)` instead of $e^{-2.4}=$ `r round(exp(-2.4), 2)` in the second group.

With more patients surviving with a shorter time frame, your sample sizes become

$n_1 =$ 25 / ((1-0.2)(1-`r round(exp(-0.8), 2)`)) 
= `r round(25 / (0.8*(1-exp(-0.8))), 1)`.

$n_2 =$ 50 / ((1-0.2)(1-`r round(exp(-1.6), 2)`)) 
= `r round(50 / (0.8*(1-exp(-1.6))), 1)`.

Four years, $e^{-\lambda t}$ would be

$e^{-1.6}=$ `r round(exp(-1.6), 2)` in the first group and $e^{-3.2}=$ `r round(exp(-3.2), 2)` in the second group.

With more patients surviving with a shorter time frame, your sample sizes become

$n_1 =$ 25 / ((1-0.2)(1-`r round(exp(-1.6), 2)`)) 
= `r round(25 / (0.8*(1-exp(-1.6))), 1)`.

$n_2 =$ 50 / ((1-0.2)(1-`r round(exp(-3.2), 2)`)) 
= `r round(50 / (0.8*(1-exp(-3.2))), 1)`.

## 3. Recalculate the sample size if the baseline hazard is 0.2 or 0.6 instead of 0.4.

Remember to switch back to three years of follow-up. A smaller value of lambda is good for your patients, but bad for your research. The patients surviving three years or more jumps from $e^{-1.2}=$ `r round(exp(-1.2), 2)` to $e^{-0.6}=$ `r round(exp(-0.6), 2)` in the first group and from $e^{-2.4}=$ `r round(exp(-2.4), 2)` to $e^{-1.2}=$ `r round(exp(-1.2), 2)` in the second group.

$n_1 =$ 25 / ((1-0.2)(1-`r round(exp(-0.6), 2)`)) 
= `r round(25 / (0.8*(1-exp(-0.6))), 1)`.

$n_2 =$ 50 / ((1-0.2)(1-`r round(exp(-1.2), 2)`)) 
= `r round(50 / (0.8*(1-exp(-1.2))), 1)`.

By the same logic, a higher baseline hazard should be bad for your patients but good for your research.

$n_1 =$ 25 / ((1-0.2)(1-`r round(exp(-1.8), 2)`)) 
= `r round(25 / (0.8*(1-exp(-1.8))), 1)`.

$n_2 =$ 50 / ((1-0.2)(1-`r round(exp(-3.6), 2)`)) 
= `r round(50 / (0.8*(1-exp(-3.6))), 1)`.

## 4. Recalculate the sample size if the hazard ratio is 1.8 or 2.2 instead of 2.0.

A hazard ratio closer to 1.0 should force you to collect more deaths. Note that $\theta$ = log(1.8) = `r round(log(1.8), 3)`. Let's keep $\pi$ at 0.33.

```{r first-alternate-power-example}
pi <- 1/3
theta=log(1.8)
(qnorm(0.975)+qnorm(0.80))^2/(theta^2*pi*(1-pi))
```

Round this up to 105, with 35 deaths in the first group and 70 deaths in the second group.

Adjusting for survival beyond 3 years and a 20% dropout rate, you get

$n_1 =$ 35 / ((1-0.2)(1-`r round(exp(-1.2), 2)`)) 
= `r round(25 / (0.8*(1-exp(-1.2))), 1)`.

$n_2 =$ 70 / ((1-0.2)(1-`r round(exp(-1.2*1.8), 2)`)) 
= `r round(50 / (0.8*(1-exp(-1.2*1.8))), 1)`.

A larger hazard ratio should reduce the total number of deaths that you would see.

```{r second-alternate-power-example}
pi <- 1/3
theta=log(2.2)
(qnorm(0.975)+qnorm(0.80))^2/(theta^2*pi*(1-pi))
```

Round this up to 60, with 20 deaths in the first group and 40 deaths in the second group.

Adjusting for survival beyond 3 years and a 20% dropout rate, you get

$n_1 =$ 20 / ((1-0.2)(1-`r round(exp(-1.2), 2)`)) 
= `r round(25 / (0.8*(1-exp(-1.2))), 1)`.

$n_2 =$ 40 / ((1-0.2)(1-`r round(exp(-1.2*2.2), 2)`)) 
= `r round(50 / (0.8*(1-exp(-1.2*2.2))), 1)`.

## 5. Do the changes in sample size fit your intuition?

They made sense to me. I hope they made sense to you also.

## 6. Put today's date into a statistical package of your choice and convert it to a numeric value. Does the number seem surprising to you?

In Excel, May 14, 2018 translates to 43,234. Divide that by 365.25 to get 118.4 years. This seems to be consistent with a date of origin around 1900.

In R, May 14, 2018, translates to `r format(as.numeric(as.Date("2018-05-14")), big.mark=",")`. Divide again by 365.25 to get `r round(as.numeric(as.Date("2018-05-14"))/365.25, 1)` which matches a date of origin around 1970.

In SPSS, May 14, 2018 translates to 13,745,635,200. Divide first by `r format(24*60*60, big.mark=",")` (=24 hours times 60 minutes times 60 seconds) and then by 365.25 to get `r round(13745635200/(86400*365.25), 1)`. 
